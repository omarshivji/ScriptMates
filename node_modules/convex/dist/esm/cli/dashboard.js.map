{
  "version": 3,
  "sources": ["../../../src/cli/dashboard.ts"],
  "sourcesContent": ["import { Command } from \"@commander-js/extra-typings\";\nimport chalk from \"chalk\";\nimport open from \"open\";\nimport {\n  Context,\n  logMessage,\n  logOutput,\n  logWarning,\n  oneoffContext,\n} from \"../bundler/context.js\";\nimport {\n  deploymentSelectionWithinProjectFromOptions,\n  loadSelectedDeploymentCredentials,\n} from \"./lib/api.js\";\nimport { actionDescription } from \"./lib/command.js\";\nimport { getDeploymentSelection } from \"./lib/deploymentSelection.js\";\nimport { isTryItOutDeployment } from \"./lib/deployment.js\";\nimport { loadDashboardConfig } from \"./lib/localDeployment/filePaths.js\";\nimport { DEFAULT_LOCAL_DASHBOARD_API_PORT } from \"./lib/localDeployment/dashboard.js\";\nconst DASHBOARD_HOST = process.env.CONVEX_PROVISION_HOST\n  ? \"http://localhost:6789\"\n  : \"https://dashboard.convex.dev\";\n\nexport const dashboard = new Command(\"dashboard\")\n  .description(\"Open the dashboard in the browser\")\n  .allowExcessArguments(false)\n  .option(\n    \"--no-open\",\n    \"Don't automatically open the dashboard in the default browser\",\n  )\n  .addDeploymentSelectionOptions(actionDescription(\"Open the dashboard for\"))\n  .showHelpAfterError()\n  .action(async (options) => {\n    const ctx = await oneoffContext(options);\n\n    const selectionWithinProject =\n      await deploymentSelectionWithinProjectFromOptions(ctx, options);\n    const deploymentSelection = await getDeploymentSelection(ctx, options);\n    const deployment = await loadSelectedDeploymentCredentials(\n      ctx,\n      deploymentSelection,\n      selectionWithinProject,\n      { ensureLocalRunning: false },\n    );\n\n    if (deployment.deploymentFields === null) {\n      const msg = `Self-hosted deployment configured.\\n\\`${chalk.bold(\"npx convex dashboard\")}\\` is not supported for self-hosted deployments.\\nSee self-hosting instructions for how to self-host the dashboard.`;\n      logMessage(ctx, chalk.yellow(msg));\n      return;\n    }\n    if (isTryItOutDeployment(deployment.deploymentFields.deploymentName)) {\n      const dashboardConfig = loadDashboardConfig(ctx);\n      const warningMessage = `You are not currently running the dashboard locally. Make sure \\`npx convex dev\\` is running and try again.`;\n      if (dashboardConfig === null) {\n        logWarning(ctx, warningMessage);\n        return;\n      }\n\n      const queryString =\n        dashboardConfig.apiPort !== DEFAULT_LOCAL_DASHBOARD_API_PORT\n          ? `?apiPort=${dashboardConfig.apiPort}`\n          : \"\";\n      const dashboardUrl = `http://127.0.0.1:${dashboardConfig.port}${queryString}`;\n      const response = await fetch(dashboardUrl);\n      if (!response.ok) {\n        logWarning(ctx, warningMessage);\n        return;\n      }\n      await logOrOpenUrl(ctx, dashboardUrl, options.open);\n      return;\n    }\n\n    const loginUrl = deploymentDashboardUrlPage(\n      deployment.deploymentFields.deploymentName,\n      \"\",\n    );\n\n    await logOrOpenUrl(ctx, loginUrl, options.open);\n  });\n\nasync function logOrOpenUrl(ctx: Context, url: string, shouldOpen: boolean) {\n  if (shouldOpen) {\n    logMessage(ctx, chalk.gray(`Opening ${url} in the default browser...`));\n    await open(url);\n  } else {\n    logOutput(ctx, url);\n  }\n}\n\nexport function deploymentDashboardUrlPage(\n  configuredDeployment: string | null,\n  page: string,\n): string {\n  return `${DASHBOARD_HOST}/d/${configuredDeployment}${page}`;\n}\n\nexport function deploymentDashboardUrl(\n  team: string,\n  project: string,\n  deploymentName: string,\n) {\n  return `${projectDashboardUrl(team, project)}/${deploymentName}`;\n}\n\nexport function projectDashboardUrl(team: string, project: string) {\n  return `${teamDashboardUrl(team)}/${project}`;\n}\n\nexport function teamDashboardUrl(team: string) {\n  return `${DASHBOARD_HOST}/t/${team}`;\n}\n"],
  "mappings": ";AAAA,SAAS,eAAe;AACxB,OAAO,WAAW;AAClB,OAAO,UAAU;AACjB;AAAA,EAEE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AACP;AAAA,EACE;AAAA,EACA;AAAA,OACK;AACP,SAAS,yBAAyB;AAClC,SAAS,8BAA8B;AACvC,SAAS,4BAA4B;AACrC,SAAS,2BAA2B;AACpC,SAAS,wCAAwC;AACjD,MAAM,iBAAiB,QAAQ,IAAI,wBAC/B,0BACA;AAEG,aAAM,YAAY,IAAI,QAAQ,WAAW,EAC7C,YAAY,mCAAmC,EAC/C,qBAAqB,KAAK,EAC1B;AAAA,EACC;AAAA,EACA;AACF,EACC,8BAA8B,kBAAkB,wBAAwB,CAAC,EACzE,mBAAmB,EACnB,OAAO,OAAO,YAAY;AACzB,QAAM,MAAM,MAAM,cAAc,OAAO;AAEvC,QAAM,yBACJ,MAAM,4CAA4C,KAAK,OAAO;AAChE,QAAM,sBAAsB,MAAM,uBAAuB,KAAK,OAAO;AACrE,QAAM,aAAa,MAAM;AAAA,IACvB;AAAA,IACA;AAAA,IACA;AAAA,IACA,EAAE,oBAAoB,MAAM;AAAA,EAC9B;AAEA,MAAI,WAAW,qBAAqB,MAAM;AACxC,UAAM,MAAM;AAAA,IAAyC,MAAM,KAAK,sBAAsB,CAAC;AAAA;AACvF,eAAW,KAAK,MAAM,OAAO,GAAG,CAAC;AACjC;AAAA,EACF;AACA,MAAI,qBAAqB,WAAW,iBAAiB,cAAc,GAAG;AACpE,UAAM,kBAAkB,oBAAoB,GAAG;AAC/C,UAAM,iBAAiB;AACvB,QAAI,oBAAoB,MAAM;AAC5B,iBAAW,KAAK,cAAc;AAC9B;AAAA,IACF;AAEA,UAAM,cACJ,gBAAgB,YAAY,mCACxB,YAAY,gBAAgB,OAAO,KACnC;AACN,UAAM,eAAe,oBAAoB,gBAAgB,IAAI,GAAG,WAAW;AAC3E,UAAM,WAAW,MAAM,MAAM,YAAY;AACzC,QAAI,CAAC,SAAS,IAAI;AAChB,iBAAW,KAAK,cAAc;AAC9B;AAAA,IACF;AACA,UAAM,aAAa,KAAK,cAAc,QAAQ,IAAI;AAClD;AAAA,EACF;AAEA,QAAM,WAAW;AAAA,IACf,WAAW,iBAAiB;AAAA,IAC5B;AAAA,EACF;AAEA,QAAM,aAAa,KAAK,UAAU,QAAQ,IAAI;AAChD,CAAC;AAEH,eAAe,aAAa,KAAc,KAAa,YAAqB;AAC1E,MAAI,YAAY;AACd,eAAW,KAAK,MAAM,KAAK,WAAW,GAAG,4BAA4B,CAAC;AACtE,UAAM,KAAK,GAAG;AAAA,EAChB,OAAO;AACL,cAAU,KAAK,GAAG;AAAA,EACpB;AACF;AAEO,gBAAS,2BACd,sBACA,MACQ;AACR,SAAO,GAAG,cAAc,MAAM,oBAAoB,GAAG,IAAI;AAC3D;AAEO,gBAAS,uBACd,MACA,SACA,gBACA;AACA,SAAO,GAAG,oBAAoB,MAAM,OAAO,CAAC,IAAI,cAAc;AAChE;AAEO,gBAAS,oBAAoB,MAAc,SAAiB;AACjE,SAAO,GAAG,iBAAiB,IAAI,CAAC,IAAI,OAAO;AAC7C;AAEO,gBAAS,iBAAiB,MAAc;AAC7C,SAAO,GAAG,cAAc,MAAM,IAAI;AACpC;",
  "names": []
}
